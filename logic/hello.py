import tkinter as tk
from tkinter import messagebox
from db.database import cursor
from random import SystemRandom

secure_random = SystemRandom()

def Hello_init():
    stage = 0
    players = []
    loser = None

    def log(msg):
        text.config(state=tk.NORMAL)
        text.insert(tk.END, msg + "\n")
        text.see(tk.END)
        text.config(state=tk.DISABLED)

    def get_players():
        cursor.execute("SELECT firstname FROM users")
        return [row[0] for row in cursor.fetchall()]

    def next_stage(event=None):
        nonlocal stage, players

        if stage == 0:
            log("üëã –ü—Ä–∏–≤–µ—Ç —Å–Ω–æ–≤–∞, –ø–∏—Å–∞–ª —è —ç—Ç–æ –Ω–∞ —Å–∫–æ—Ä—É—é —Ä—É–∫—É.\n–ù–∞—á–Ω—ë–º\n")
            log("üìú –ü—Ä–∞–≤–∏–ª–∞:\n1: –∫—Ç–æ –ø—Ä–æ–∏–≥—Ä–∞–ª, —Ç–æ—Ç –∏ –ø–æ–ª—É—á–∞–µ—Ç.\n2: –Ω–µ –ø—Å–∏—Ö–æ–≤–∞—Ç—å.\n3: –≤—ã —É–∂–µ –≤ –±–æ—Ç–µ :)\n")
        elif stage == 1:
            log("üîå –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ...")
            log("üì• –ó–∞–≥—Ä—É–∑–∫–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤...")
            players = get_players()
            if not players:
                messagebox.showerror("–û—à–∏–±–∫–∞", "–ù–µ—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤.")
                return
            log(f"‚úÖ –ù–∞–π–¥–µ–Ω–æ: {len(players)} –∏–≥—Ä–æ–∫–æ–≤.")
            log(f"üë• –£—á–∞—Å—Ç–Ω–∏–∫–∏: {', '.join(players)}")
        elif stage == 2:
            log("üé≤ –ó–∞–ø—É—Å–∫ –∂–µ—Ä–µ–±—å—ë–≤–∫–∏...")
            root.after(100, choose_loser)
            return
        stage += 1

    def choose_loser():
        nonlocal loser
        loser = secure_random.choice(players)
        log(f"‚ùå {loser}, —Ç—ã –ø—Ä–æ–∏–≥—Ä–∞–ª. –î–∞, {loser}, —ç—Ç–æ —Ä–µ–∞–ª—å–Ω–æ —Ç—ã.")
        answer = messagebox.askyesno("–ò—Å–ø—ã—Ç–∞–Ω–∏–µ", f"{loser}, —Ç—ã –ø—Ä–æ–∏–≥—Ä–∞–ª. –í—ã–ø–æ–ª–Ω—è—Ç—å –∏—Å–ø—ã—Ç–∞–Ω–∏–µ?")
        if answer:
            task = secure_random.choice([
    "—Å–¥–µ–ª–∞—Ç—å –∫–æ–º–ø–ª–∏–º–µ–Ω—Ç –∫–∞–∂–¥–æ–º—É –∏–≥—Ä–æ–∫—É. –ù–∞–ø—Ä–∏–º–µ—Ä: '–¢—ã —Å–µ–≥–æ–¥–Ω—è –≤—ã–≥–ª—è–¥–∏—à—å –ø–æ—Ç—Ä—è—Å–∞—é—â–µ!'",
    "—Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å —Å–∞–º—ã–π –Ω–µ–ª–æ–≤–∫–∏–π —Å–ª—É—á–∞–π. –î–∞–≤–∞–π, –Ω–µ —Å—Ç–µ—Å–Ω—è–π—Å—è!)",
    "–ø–æ–∑–¥—Ä–∞–≤–∏—Ç—å —Å–µ–±—è –æ—Ç –∏–º–µ–Ω–∏ –ø—Ä–µ–∑–∏–¥–µ–Ω—Ç–∞ –£–∫—Ä–∞–∏–Ω—ã (–Ω–∞ –∫–∞–º–µ—Ä—É + –Ω–∞ —É–∫—Ä–∞–∏–Ω—Å–∫–æ–º)",
    "—Å–∫–∞–∑–∞—Ç—å '—è –ø—Ä–æ–∏–≥—Ä–∞–ª, –Ω–æ —è —Å—á–∞—Å—Ç–ª–∏–≤' –Ω–∞ –∫–∞–º–µ—Ä—É",
    "–ø—Ä–∏–¥—É–º–∞—Ç—å –∏ –≤—Å–ª—É—Ö —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –∫–æ—Ä–æ—Ç–∫–∏–π –∞–Ω–µ–∫–¥–æ—Ç –ø—Ä–æ –∫–æ—Ç–∞, —Ç—Ä–∞–∫—Ç–æ—Ä –∏ –±–∞–Ω–∞–Ω",
    "–Ω–∞–∑–≤–∞—Ç—å 5 –ª—é–±–∏–º—ã—Ö —Ñ–∏–ª—å–º–æ–≤ –∑–∞ 15 —Å–µ–∫—É–Ω–¥. –ö—Ç–æ –∑–∞—Å—ë–∫ –≤—Ä–µ–º—è?",
    "–ø–æ–∫–∞–∑–∞—Ç—å, –∫–∞–∫ —Ç—ã —Ç–∞–Ω—Ü—É–µ—à—å, –∫–æ–≥–¥–∞ –æ–¥–∏–Ω –¥–æ–º–∞ (10 —Å–µ–∫—É–Ω–¥)",
    "—Å–ø–µ—Ç—å —Å—Ç—Ä–æ—á–∫—É –∏–∑ –ª—é–±–æ–π –ø–µ—Å–Ω–∏. –ë–µ–∑ –æ—Ç–º–∞–∑–æ–∫!",
    "—Å–¥–µ–ª–∞—Ç—å –≥–æ–ª–æ—Å–æ–º –ø–∞—Ä–æ–¥–∏—é –Ω–∞ –≤–µ–¥—É—â–µ–≥–æ —Ç–µ–ª–µ–≤–∏–¥–µ–Ω–∏—è –∏–ª–∏ –¥–∏–∫—Ç–æ—Ä–∞ –Ω–æ–≤–æ—Å—Ç–µ–π",
    "—Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å, –∑–∞ —á—Ç–æ —Ç—ã –ª—é–±–∏—à—å —Å–≤–æ–∏—Ö –±–ª–∏–∑–∫–∏—Ö (—Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ –∫–∞–∂–¥–æ–≥–æ)",
    "—Å–¥–µ–ª–∞—Ç—å 5 —Å–º–µ—à–Ω—ã—Ö –ª–∏—Ü –ø–æ–¥—Ä—è–¥ –∏ –ø–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ–º",
    "–ø—Ä–æ–∏–∑–Ω–µ—Å—Ç–∏ —Å–∫–æ—Ä–æ–≥–æ–≤–æ—Ä–∫—É: '–ö–∞—Ä–ª —É –ö–ª–∞—Ä—ã —É–∫—Ä–∞–ª –∫–æ—Ä–∞–ª–ª—ã, –∞ –ö–ª–∞—Ä–∞ —É –ö–∞—Ä–ª–∞ ‚Äî –∫–ª–∞—Ä–Ω–µ—Ç' –±–µ–∑ –∑–∞–ø–∏–Ω–∫–∏",
    "–æ–±–Ω—è—Ç—å –≤—Å–µ—Ö, –∫—Ç–æ –≤ –∫–æ–º–Ω–∞—Ç–µ. –ò–ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ–≥–æ, –µ—Å–ª–∏ —Å—Ç–µ—Å–Ω—è–µ—à—å—Å—è :)",
    
    # –ù–æ–≤—ã–µ
    "—Å–∫–∞–∑–∞—Ç—å –≤—Å–ª—É—Ö: '–Ø ‚Äî –∫–æ—Ä–æ–ª—åÂ∞ª. –í—Å–µ –¥–æ–ª–∂–Ω—ã –º–µ–Ω—è –±–æ—è—Ç—å—Å—è!'",
    "–ø—Ä–æ–∏–∑–Ω–µ—Å—Ç–∏ —Ñ—Ä–∞–∑—É '–Ø –æ—à–∏–±—Å—è –¥–≤–µ—Ä—å—é, —ç—Ç–æ –Ω–µ –º–æ—è –≤—Å–µ–ª–µ–Ω–Ω–∞—è' –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–∞—Ñ–æ—Å–Ω–æ",
    "—Å–¥–µ–ª–∞—Ç—å 10 –∫–æ–º–ø–ª–∏–º–µ–Ω—Ç–æ–≤ —Å–µ–±–µ —Å–∞–º–æ–º—É (–≤—Å–ª—É—Ö)",
    "—Å—ã–≥—Ä–∞—Ç—å –Ω–∞ '–≤–æ–∑–¥—É—à–Ω–æ–π —Å–∫—Ä–∏–ø–∫–µ' ‚Äî –ø–æ–¥ –º—É–∑—ã–∫—É, –±–µ–∑ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞, 10 —Å–µ–∫—É–Ω–¥",
    "—Å–¥–µ–ª–∞—Ç—å –ø–∞—Ä–æ–¥–∏—é –Ω–∞ –ª—é–±–æ–≥–æ –∏–≥—Ä–æ–∫–∞ –≤ –∫–æ–º–Ω–∞—Ç–µ (–º–∏–º–∏–∫–∞, —Ä–µ—á—å)",
    "–ø—Ä–æ—á–∏—Ç–∞—Ç—å –∞–±–∑–∞—Ü —Ç–µ–∫—Å—Ç–∞ —Å –∏–Ω—Ç–æ–Ω–∞—Ü–∏–µ–π –∞–Ω–∏–º–µ-–ø–µ—Ä—Å–æ–Ω–∞–∂–∞",
    "–ø—Ä–æ–æ—Ä–∞—Ç—å –∫–∞–∫ —Å—É–º–∞—Å—à–µ–¥—à–∏–π —É—á—ë–Ω—ã–π: '–Ø –ø–æ—á—Ç–∏ –∑–∞–≤–µ—Ä—à–∏–ª —Å–≤–æ–π –ø—Ä–æ–µ–∫—Ç!!!'",
    "–ø—Ä–∏–∑–Ω–∞—Ç—å—Å—è –≤ –ª—é–±–≤–∏ –ø—Ä–µ–¥–º–µ—Ç—É —Ä—è–¥–æ–º: '–Ø –≤—Å–µ–≥–¥–∞ –ª—é–±–∏–ª —Ç–µ–±—è, –∫—Ä—É–∂–∫–∞'",
    "–ø—Ä–æ–∏–∑–Ω–µ—Å—Ç–∏ –¥–ª–∏–Ω–Ω—É—é —Ñ—Ä–∞–∑—É —à—ë–ø–æ—Ç–æ–º, –ø–æ—Ç–æ–º –∫—Ä–∏–∫–Ω—É—Ç—å: '–ê –Ø –ù–ï –®–ï–ü–¢–ê–õ!'",
    "–ø—Ä–æ—á–∏—Ç–∞—Ç—å –ª—é–±–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –∑–∞–¥–æ–º –Ω–∞–ø–µ—Ä—ë–¥ (–±—É–∫–≤—ã, –Ω–µ —Å–ª–æ–≤–∞)",
    "–∏–∑–æ–±—Ä–∞–∑–∏—Ç—å, —á—Ç–æ —Ç—ã ‚Äî –ò–ò, –∫–æ—Ç–æ—Ä—ã–π —Ç–æ–ª—å–∫–æ —á—Ç–æ –æ–±—Ä—ë–ª —Å–æ–∑–Ω–∞–Ω–∏–µ",
    "–ø–æ–∫–∞–∑–∞—Ç—å, –∫–∞–∫ —Ç—ã —Ä–∞–¥—É–µ—à—å—Å—è, –∫–æ–≥–¥–∞ –Ω–∞–∫–æ–Ω–µ—Ü-—Ç–æ –≤—ã–∫–ª—é—á–∞—é—Ç —à–∫–æ–ª—É –Ω–∞–≤—Å–µ–≥–¥–∞",
    "–∏–∑–æ–±—Ä–∞–∑–∏—Ç—å –≤–ª—é–±–ª—ë–Ω–Ω–æ–≥–æ —Ä–æ–±–æ—Ç–∞",
    "—Å—ã–≥—Ä–∞—Ç—å —Å—Ü–µ–Ω—É '–º–µ–Ω—è –≤—ã–≥–Ω–∞–ª–∏ –∏–∑ –∫–ª–∞–Ω–∞', —Å—Ç—Ä–∞–¥–∞—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ",
    "–Ω–∞–ø–∏—Å–∞—Ç—å —Å–ª—É—á–∞–π–Ω–æ–º—É –¥—Ä—É–≥—É: '–£ —Ç–µ–±—è –µ—Å—Ç—å —Ä–µ—Ü–µ–ø—Ç –±–æ—Ä—â–∞?' –∏ –ø–æ–∫–∞–∑–∞—Ç—å –æ—Ç–≤–µ—Ç",
    "–ø–æ–∑–≤–æ–Ω–∏—Ç—å –∫–æ–º—É-—Ç–æ –∏ —Å–ø—Ä–æ—Å–∏—Ç—å: '–¢—ã —Ç–æ–∂–µ —Å–ª—ã—à–∞–ª —ç—Ç–∏ –≥–æ–ª–æ—Å–∞?'",
    "—Å–¥–µ–ª–∞—Ç—å —Å—Ç–æ—Ä–∏—Å —Å —Ñ—Ä–∞–∑–æ–π: '–°–µ–≥–æ–¥–Ω—è –≤—Å—ë –ø–æ-–¥—Ä—É–≥–æ–º—É...' (–∏ –∑–∞–≥–∞–¥–æ—á–Ω—ã–π –≤–∑–≥–ª—è–¥)",
    "–≤ —Ç–µ—á–µ–Ω–∏–µ 10 –º–∏–Ω—É—Ç –≥–æ–≤–æ—Ä–∏—Ç—å —Å –ª—é–¥—å–º–∏ –æ—Ç —Ç—Ä–µ—Ç—å–µ–≥–æ –ª–∏—Ü–∞ ('–î–µ–Ω–∏—Å –Ω–µ —Å–æ–≥–ª–∞—Å–µ–Ω.')",
    "–ø—Ä–∏–¥—É–º–∞—Ç—å –Ω–æ–≤—É—é —Ä–µ–ª–∏–≥–∏—é –∑–∞ 30 —Å–µ–∫—É–Ω–¥. –ù–∞–∑–≤–∞–Ω–∏–µ –∏ –ø—Ä–∞–≤–∏–ª–∞ ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ",
    "–ø—Ä–∏–¥—É–º–∞—Ç—å –º–∏–Ω–∏-–ø—Ä–æ–≥—Ä–∞–º–º—É –Ω–∞ –ª—é–±–æ–º —è–∑—ã–∫–µ (—É—Å—Ç–Ω–æ) —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º",
    "—Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –ø–ª–∞–Ω, –∫–∞–∫ —Ç—ã –±—ã –≤–∑–ª–æ–º–∞–ª —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫ —Å –ò–ò",
    "–æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –ª—é–±–æ–π –≤–æ–ø—Ä–æ—Å —Å —Ñ—Ä–∞–∑–æ–π: '–≠—Ç–æ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–≤–∞–Ω—Ç–æ–≤–æ–≥–æ –ø–æ–ª—è'"
    ])

            log(f"üåÄ –ò—Å–ø—ã—Ç–∞–Ω–∏–µ –¥–ª—è {loser}: {task}")
        else:
            log("üö´ –ù—É –ª–∞–¥–Ω–æ, —Ç–æ–≥–¥–∞ –±–µ–∑ –∑–∞–¥–∞–Ω–∏—è :)")

    def reset_game():
        nonlocal stage, players, loser
        stage = 0
        players = []
        loser = None
        text.config(state=tk.NORMAL)
        text.delete("1.0", tk.END)
        text.config(state=tk.DISABLED)
        log("üîÅ –ò–≥—Ä–∞ —Å–±—Ä–æ—à–µ–Ω–∞. –ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –Ω–∞—á–∞–ª–∞.")

    # === –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å ===
    root = tk.Tk()
    root.title("üéÆ –ò–≥—Ä–∞: –ö—Ç–æ –ø—Ä–æ–∏–≥—Ä–∞–ª?")
    root.geometry("700x450")
    root.configure(bg="#1e1e1e")

    # === –¢–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ —Å–æ —Å–∫—Ä–æ–ª–ª–æ–º ===
    frame = tk.Frame(root, bg="#1e1e1e")
    frame.pack(fill=tk.BOTH, expand=True, padx=10, pady=10)

    scrollbar = tk.Scrollbar(frame)
    scrollbar.pack(side=tk.RIGHT, fill=tk.Y)

    text = tk.Text(
        frame,
        height=15,
        font=("Segoe UI", 12),
        bg="#2d2d2d",
        fg="#e5e5e5",
        insertbackground="white",
        wrap=tk.WORD,
        yscrollcommand=scrollbar.set,
        state=tk.DISABLED
    )
    text.pack(fill=tk.BOTH, expand=True)
    scrollbar.config(command=text.yview)

    # === –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è ===
    label = tk.Label(root, text="–ù–∞–∂–º–∏ Enter, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å", font=("Segoe UI", 12), bg="#1e1e1e", fg="#bbbbbb")
    label.pack(pady=5)

    # === –ö–Ω–æ–ø–∫–∞ —Å–±—Ä–æ—Å–∞ ===
    reset_btn = tk.Button(root, text="üîÑ –°–±—Ä–æ—Å–∏—Ç—å –∏–≥—Ä—É", font=("Segoe UI", 10), bg="#444", fg="white", command=reset_game)
    reset_btn.pack(pady=5)

    root.bind("<Return>", next_stage)
    log("üîÑ –ì–æ—Ç–æ–≤–æ. –ù–∞–∂–º–∏ Enter –¥–ª—è –Ω–∞—á–∞–ª–∞.")
    root.mainloop()
